#!/bin/zsh
# <ref>
# https://gist.github.com/aquaductape/
# https://gist.github.com/LukeSmithxyz/

#
# making sure vim is persistent in linux-gnu environments
#
if [[ "$OSTYPE" == "linux-gnu" ]]; then
    export EDITOR=/usr/bin/vim
    export VISUAL=/usr/bin/vim
fi


#
# auto/tab complete:
#
autoload -U compinit
zstyle ':completion:*' menu select
zmodload zsh/complist
compinit
_comp_options+=(globdots)

#
# vi mode cursor mode
#
bindkey -v
export KEYTIMEOUT=1

function zle-keymap-select {
    if [[ ${KEYMAP} == vicmd ]] ||
        [[ $1 = 'block' ]]; then
    echo -ne '\e[1 q'
elif [[ ${KEYMAP} == main ]] ||
    [[ ${KEYMAP} == viins ]] ||
    [[ ${KEYMAP} = '' ]] ||
    [[ $1 = 'beam' ]]; then
echo -ne '\e[5 q'
fi
}
zle -N zle-keymap-select

zle-line-init() {
echo -ne "\e[5 q"
}

zle -N zle-line-init
echo -ne '\e[5 q'       # use beam shape cursor on startup.

preexec() {
    echo -ne '\e[5 q';  # use beam shape cursor for each new prompt.
}

#
# change in quotation marks (the equivalent of Tim Popes' surround)
#
autoload -U select-quoted
zle -N select-quoted
for m in visual viopp; do
    for c in {a,i}{\',\",\`}; do
        bindkey -M $m $c select-quoted
    done
done

#
# change in brackets (the equivalent of Tim Popes' surround)
#
autoload -U select-bracketed
zle -N select-bracketed
for m in visual viopp; do
    for c in {a,i}${(s..)^:-'()[]{}<>bB'}; do
        bindkey -M $m $c select-bracketed
    done
done
