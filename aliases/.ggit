#!/bin/zsh

# -- gg = greater git
# -- All unsafe/remove operations are indicated with a bang (gg!)

# -- relative difference
function greater-git-diff() {
	# if changes already committed
	if git diff-index --quiet HEAD --; then
		git diff HEAD^ HEAD
	else
		# if changes made (but not staged)
		if git diff --cached --exit-code; then
			git diff
		else
			# if changes staged (but not committed)
			git diff --cached
		fi
	fi
}

# -- safe-pulling submodules
function greater-git-pull() {
	if [[ $(git submodule foreach 'git status') ]]; then
		echo " -- found submodules!"
		echo " -- switching to recursive greater-git-pull strategy"
		git submodule update --remote
		git pull --recurse-submodules
	else
		git pull
	fi
}

# -- safe-pushing with submodules
function greater-git-push() {
	if [[ $(git submodule foreach 'git status') ]]; then
		echo " -- todo implement safety check to protect submodules!"
	else
		git push
	fi
}

# -- removing a submodule
function greater-git-rm-submodule() {
	git submodule deinit -f -- $1
	rm -rf .git/modules/$1
	git rm -f $1
}

# -- renaming a submodule
function greater-git-rename-submodule() {
	git submodule deinit -f -- $1
	rm -rf .git/modules/$1
	git rm -f $1
	git submodule add $2
}
# -- renaming a submodule
alias ggmvsub='greater-git-rename-submodule'

# -- undoing local changes
function greater-git-undo() {
	# -- un-staging files ??? repeat ???
	# alias ggrS='git restore --staged'

	# -- deleting new changes (not yet staged)
	# alias ggr='git restore'
	git restore $1
}

# -- removing files
function greater-git-remove() {
	git rm --cached $1
	rm -rf $1
}

# -- removing files
alias gg!='greater-git-remove'

# -- adding remote
alias gg+ro='git remote add origin'

# -- pushing after adding an origin
alias ggpush!='git push -u --force origin master'

# -- cloning
alias gg+='git clone'

# -- adding and removing a submodules
alias gg+sub='git submodule add'
alias gg-sub='greater-git-rm-submodule'

# -- removing changes
alias gg!changes='greater-git-undo'

# -- checking out
alias ggco='git checkout'

# -- moving files
alias ggm='git mv'

# -- viewing repository size
alias ggsize='git count-objects -vH'

# -- viewing repository status
alias ggs='git status'

# -- adding cache
alias gga='git add .'
alias ggaP='git add --patch $1'

# -- viewing repository status
alias ggc='git commit -m'

# -- resetting
alias gg!h='git reset --hard'
alias gg!s='git reset --soft'

# -- viewing logs
alias ggl='git log'
alias ggrl='git reflog'

# --verifying commits are signed: G=signed | N=not signed
alias ggv='git log --pretty="format:%h %G? %aN  %s"'

# -- submodule-pulling
alias ggpull='greater-git-pull'

# -- pushing
alias ggpush='greater-git-push'

# # -- stashing
alias ggst='git stash'

# -- what changed?
alias ggd='greater-git-diff'
alias ggdt='git difftool'

# -- re-basing
alias ggrebase='git rebase -i'

# -- tracked files
alias ggtracked='git ls-tree -r master --name-only'
